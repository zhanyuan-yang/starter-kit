{"ast":null,"code":"/**\n * Module dependencies.\n */\nvar IncomingMessageExt = require('../http/request');\n/**\n * Passport initialization.\n *\n * Intializes Passport for incoming requests, allowing authentication strategies\n * to be applied.\n *\n * If sessions are being utilized, applications must set up Passport with\n * functions to serialize a user into and out of a session.  For example, a\n * common pattern is to serialize just the user ID into the session (due to the\n * fact that it is desirable to store the minimum amount of data in a session).\n * When a subsequent request arrives for the session, the full User object can\n * be loaded from the database by ID.\n *\n * Note that additional middleware is required to persist login state, so we\n * must use the `connect.session()` middleware _before_ `passport.initialize()`.\n *\n * If sessions are being used, this middleware must be in use by the\n * Connect/Express application for Passport to operate.  If the application is\n * entirely stateless (not using sessions), this middleware is not necessary,\n * but its use will not have any adverse impact.\n *\n * Examples:\n *\n *     app.use(connect.cookieParser());\n *     app.use(connect.session({ secret: 'keyboard cat' }));\n *     app.use(passport.initialize());\n *     app.use(passport.session());\n *\n *     passport.serializeUser(function(user, done) {\n *       done(null, user.id);\n *     });\n *\n *     passport.deserializeUser(function(id, done) {\n *       User.findById(id, function (err, user) {\n *         done(err, user);\n *       });\n *     });\n *\n * @return {Function}\n * @api public\n */\n\n\nmodule.exports = function initialize(passport, options) {\n  options = options || {};\n  return function initialize(req, res, next) {\n    req.login = req.logIn = req.logIn || IncomingMessageExt.logIn;\n    req.logout = req.logOut = req.logOut || IncomingMessageExt.logOut;\n    req.isAuthenticated = req.isAuthenticated || IncomingMessageExt.isAuthenticated;\n    req.isUnauthenticated = req.isUnauthenticated || IncomingMessageExt.isUnauthenticated;\n    req._sessionManager = passport._sm;\n\n    if (options.userProperty) {\n      req._userProperty = options.userProperty;\n    }\n\n    var compat = options.compat === undefined ? true : options.compat;\n\n    if (compat) {\n      // `passport@0.5.1` [removed][1] all internal use of `req._passport`.\n      // From the standpoint of this package, this should have been a\n      // non-breaking change.  However, some strategies (such as `passport-azure-ad`)\n      // depend directly on `passport@0.4.x` or earlier.  `require`-ing earlier\n      // versions of `passport` has the effect of monkeypatching `http.IncomingMessage`\n      // with `logIn`, `logOut`, `isAuthenticated` and `isUnauthenticated`\n      // functions that [expect][2] the `req._passport` property to exist.\n      // Since pre-existing functions on `req` are given [preference][3], this\n      // results in [issues][4].\n      //\n      // The changes here restore the expected properties needed when earlier\n      // versions of `passport` are `require`-ed.  This compatibility mode is\n      // enabled by default, and can be disabld by simply not `use`-ing `passport.initialize()`\n      // middleware or setting `compat: false` as an option to the middleware.\n      //\n      // An alternative approach to addressing this issue would be to not\n      // preferentially use pre-existing functions on `req`, but rather always\n      // overwrite `req.logIn`, etc. with the versions of those functions shiped\n      // with `authenticate()` middleware.  This option should be reconsidered\n      // in a future major version release.\n      //\n      // [1]: https://github.com/jaredhanson/passport/pull/875\n      // [2]: https://github.com/jaredhanson/passport/blob/v0.4.1/lib/http/request.js\n      // [3]: https://github.com/jaredhanson/passport/blob/v0.5.1/lib/middleware/authenticate.js#L96\n      // [4]: https://github.com/jaredhanson/passport/issues/877\n      passport._userProperty = options.userProperty || 'user';\n      req._passport = {};\n      req._passport.instance = passport;\n    }\n\n    next();\n  };\n};","map":{"version":3,"names":["IncomingMessageExt","require","module","exports","initialize","passport","options","req","res","next","login","logIn","logout","logOut","isAuthenticated","isUnauthenticated","_sessionManager","_sm","userProperty","_userProperty","compat","undefined","_passport","instance"],"sources":["/Users/zhanyuanyang/Desktop/react/starter-kit/node_modules/passport/lib/middleware/initialize.js"],"sourcesContent":["/**\n * Module dependencies.\n */\nvar IncomingMessageExt = require('../http/request');\n\n\n/**\n * Passport initialization.\n *\n * Intializes Passport for incoming requests, allowing authentication strategies\n * to be applied.\n *\n * If sessions are being utilized, applications must set up Passport with\n * functions to serialize a user into and out of a session.  For example, a\n * common pattern is to serialize just the user ID into the session (due to the\n * fact that it is desirable to store the minimum amount of data in a session).\n * When a subsequent request arrives for the session, the full User object can\n * be loaded from the database by ID.\n *\n * Note that additional middleware is required to persist login state, so we\n * must use the `connect.session()` middleware _before_ `passport.initialize()`.\n *\n * If sessions are being used, this middleware must be in use by the\n * Connect/Express application for Passport to operate.  If the application is\n * entirely stateless (not using sessions), this middleware is not necessary,\n * but its use will not have any adverse impact.\n *\n * Examples:\n *\n *     app.use(connect.cookieParser());\n *     app.use(connect.session({ secret: 'keyboard cat' }));\n *     app.use(passport.initialize());\n *     app.use(passport.session());\n *\n *     passport.serializeUser(function(user, done) {\n *       done(null, user.id);\n *     });\n *\n *     passport.deserializeUser(function(id, done) {\n *       User.findById(id, function (err, user) {\n *         done(err, user);\n *       });\n *     });\n *\n * @return {Function}\n * @api public\n */\nmodule.exports = function initialize(passport, options) {\n  options = options || {};\n  \n  return function initialize(req, res, next) {\n    req.login =\n    req.logIn = req.logIn || IncomingMessageExt.logIn;\n    req.logout =\n    req.logOut = req.logOut || IncomingMessageExt.logOut;\n    req.isAuthenticated = req.isAuthenticated || IncomingMessageExt.isAuthenticated;\n    req.isUnauthenticated = req.isUnauthenticated || IncomingMessageExt.isUnauthenticated;\n    \n    req._sessionManager = passport._sm;\n    \n    if (options.userProperty) {\n      req._userProperty = options.userProperty;\n    }\n    \n    var compat = (options.compat === undefined) ? true : options.compat;\n    if (compat) {\n      // `passport@0.5.1` [removed][1] all internal use of `req._passport`.\n      // From the standpoint of this package, this should have been a\n      // non-breaking change.  However, some strategies (such as `passport-azure-ad`)\n      // depend directly on `passport@0.4.x` or earlier.  `require`-ing earlier\n      // versions of `passport` has the effect of monkeypatching `http.IncomingMessage`\n      // with `logIn`, `logOut`, `isAuthenticated` and `isUnauthenticated`\n      // functions that [expect][2] the `req._passport` property to exist.\n      // Since pre-existing functions on `req` are given [preference][3], this\n      // results in [issues][4].\n      //\n      // The changes here restore the expected properties needed when earlier\n      // versions of `passport` are `require`-ed.  This compatibility mode is\n      // enabled by default, and can be disabld by simply not `use`-ing `passport.initialize()`\n      // middleware or setting `compat: false` as an option to the middleware.\n      //\n      // An alternative approach to addressing this issue would be to not\n      // preferentially use pre-existing functions on `req`, but rather always\n      // overwrite `req.logIn`, etc. with the versions of those functions shiped\n      // with `authenticate()` middleware.  This option should be reconsidered\n      // in a future major version release.\n      //\n      // [1]: https://github.com/jaredhanson/passport/pull/875\n      // [2]: https://github.com/jaredhanson/passport/blob/v0.4.1/lib/http/request.js\n      // [3]: https://github.com/jaredhanson/passport/blob/v0.5.1/lib/middleware/authenticate.js#L96\n      // [4]: https://github.com/jaredhanson/passport/issues/877\n      passport._userProperty = options.userProperty || 'user';\n      \n      req._passport = {};\n      req._passport.instance = passport;\n    }\n    \n    next();\n  };\n};\n"],"mappings":"AAAA;AACA;AACA;AACA,IAAIA,kBAAkB,GAAGC,OAAO,CAAC,iBAAD,CAAhC;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAC,MAAM,CAACC,OAAP,GAAiB,SAASC,UAAT,CAAoBC,QAApB,EAA8BC,OAA9B,EAAuC;EACtDA,OAAO,GAAGA,OAAO,IAAI,EAArB;EAEA,OAAO,SAASF,UAAT,CAAoBG,GAApB,EAAyBC,GAAzB,EAA8BC,IAA9B,EAAoC;IACzCF,GAAG,CAACG,KAAJ,GACAH,GAAG,CAACI,KAAJ,GAAYJ,GAAG,CAACI,KAAJ,IAAaX,kBAAkB,CAACW,KAD5C;IAEAJ,GAAG,CAACK,MAAJ,GACAL,GAAG,CAACM,MAAJ,GAAaN,GAAG,CAACM,MAAJ,IAAcb,kBAAkB,CAACa,MAD9C;IAEAN,GAAG,CAACO,eAAJ,GAAsBP,GAAG,CAACO,eAAJ,IAAuBd,kBAAkB,CAACc,eAAhE;IACAP,GAAG,CAACQ,iBAAJ,GAAwBR,GAAG,CAACQ,iBAAJ,IAAyBf,kBAAkB,CAACe,iBAApE;IAEAR,GAAG,CAACS,eAAJ,GAAsBX,QAAQ,CAACY,GAA/B;;IAEA,IAAIX,OAAO,CAACY,YAAZ,EAA0B;MACxBX,GAAG,CAACY,aAAJ,GAAoBb,OAAO,CAACY,YAA5B;IACD;;IAED,IAAIE,MAAM,GAAId,OAAO,CAACc,MAAR,KAAmBC,SAApB,GAAiC,IAAjC,GAAwCf,OAAO,CAACc,MAA7D;;IACA,IAAIA,MAAJ,EAAY;MACV;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACAf,QAAQ,CAACc,aAAT,GAAyBb,OAAO,CAACY,YAAR,IAAwB,MAAjD;MAEAX,GAAG,CAACe,SAAJ,GAAgB,EAAhB;MACAf,GAAG,CAACe,SAAJ,CAAcC,QAAd,GAAyBlB,QAAzB;IACD;;IAEDI,IAAI;EACL,CAhDD;AAiDD,CApDD"},"metadata":{},"sourceType":"script"}