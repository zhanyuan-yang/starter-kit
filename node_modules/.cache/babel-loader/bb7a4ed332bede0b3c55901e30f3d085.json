{"ast":null,"code":"/**\n * Module dependencies.\n */\nvar pause = require('pause'),\n    util = require('util'),\n    Strategy = require('passport-strategy');\n/**\n * `SessionStrategy` constructor.\n *\n * @api public\n */\n\n\nfunction SessionStrategy(options, deserializeUser) {\n  if (typeof options == 'function') {\n    deserializeUser = options;\n    options = undefined;\n  }\n\n  options = options || {};\n  Strategy.call(this);\n  this.name = 'session';\n  this._key = options.key || 'passport';\n  this._deserializeUser = deserializeUser;\n}\n/**\n * Inherit from `Strategy`.\n */\n\n\nutil.inherits(SessionStrategy, Strategy);\n/**\n * Authenticate request based on the current session state.\n *\n * The session authentication strategy uses the session to restore any login\n * state across requests.  If a login session has been established, `req.user`\n * will be populated with the current user.\n *\n * This strategy is registered automatically by Passport.\n *\n * @param {Object} req\n * @param {Object} options\n * @api protected\n */\n\nSessionStrategy.prototype.authenticate = function (req, options) {\n  if (!req.session) {\n    return this.error(new Error('Login sessions require session support. Did you forget to use `express-session` middleware?'));\n  }\n\n  options = options || {};\n  var self = this,\n      su;\n\n  if (req.session[this._key]) {\n    su = req.session[this._key].user;\n  }\n\n  if (su || su === 0) {\n    // NOTE: Stream pausing is desirable in the case where later middleware is\n    //       listening for events emitted from request.  For discussion on the\n    //       matter, refer to: https://github.com/jaredhanson/passport/pull/106\n    var paused = options.pauseStream ? pause(req) : null;\n\n    this._deserializeUser(su, req, function (err, user) {\n      if (err) {\n        return self.error(err);\n      }\n\n      if (!user) {\n        delete req.session[self._key].user;\n      } else {\n        var property = req._userProperty || 'user';\n        req[property] = user;\n      }\n\n      self.pass();\n\n      if (paused) {\n        paused.resume();\n      }\n    });\n  } else {\n    self.pass();\n  }\n};\n/**\n * Expose `SessionStrategy`.\n */\n\n\nmodule.exports = SessionStrategy;","map":{"version":3,"names":["pause","require","util","Strategy","SessionStrategy","options","deserializeUser","undefined","call","name","_key","key","_deserializeUser","inherits","prototype","authenticate","req","session","error","Error","self","su","user","paused","pauseStream","err","property","_userProperty","pass","resume","module","exports"],"sources":["/Users/zhanyuanyang/Desktop/react/starter-kit/node_modules/passport/lib/strategies/session.js"],"sourcesContent":["/**\n * Module dependencies.\n */\nvar pause = require('pause')\n  , util = require('util')\n  , Strategy = require('passport-strategy');\n\n\n/**\n * `SessionStrategy` constructor.\n *\n * @api public\n */\nfunction SessionStrategy(options, deserializeUser) {\n  if (typeof options == 'function') {\n    deserializeUser = options;\n    options = undefined;\n  }\n  options = options || {};\n  \n  Strategy.call(this);\n  this.name = 'session';\n  this._key = options.key || 'passport';\n  this._deserializeUser = deserializeUser;\n}\n\n/**\n * Inherit from `Strategy`.\n */\nutil.inherits(SessionStrategy, Strategy);\n\n/**\n * Authenticate request based on the current session state.\n *\n * The session authentication strategy uses the session to restore any login\n * state across requests.  If a login session has been established, `req.user`\n * will be populated with the current user.\n *\n * This strategy is registered automatically by Passport.\n *\n * @param {Object} req\n * @param {Object} options\n * @api protected\n */\nSessionStrategy.prototype.authenticate = function(req, options) {\n  if (!req.session) { return this.error(new Error('Login sessions require session support. Did you forget to use `express-session` middleware?')); }\n  options = options || {};\n\n  var self = this, \n      su;\n  if (req.session[this._key]) {\n    su = req.session[this._key].user;\n  }\n\n  if (su || su === 0) {\n    // NOTE: Stream pausing is desirable in the case where later middleware is\n    //       listening for events emitted from request.  For discussion on the\n    //       matter, refer to: https://github.com/jaredhanson/passport/pull/106\n    \n    var paused = options.pauseStream ? pause(req) : null;\n    this._deserializeUser(su, req, function(err, user) {\n      if (err) { return self.error(err); }\n      if (!user) {\n        delete req.session[self._key].user;\n      } else {\n        var property = req._userProperty || 'user';\n        req[property] = user;\n      }\n      self.pass();\n      if (paused) {\n        paused.resume();\n      }\n    });\n  } else {\n    self.pass();\n  }\n};\n\n\n/**\n * Expose `SessionStrategy`.\n */\nmodule.exports = SessionStrategy;\n"],"mappings":"AAAA;AACA;AACA;AACA,IAAIA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAAnB;AAAA,IACIC,IAAI,GAAGD,OAAO,CAAC,MAAD,CADlB;AAAA,IAEIE,QAAQ,GAAGF,OAAO,CAAC,mBAAD,CAFtB;AAKA;AACA;AACA;AACA;AACA;;;AACA,SAASG,eAAT,CAAyBC,OAAzB,EAAkCC,eAAlC,EAAmD;EACjD,IAAI,OAAOD,OAAP,IAAkB,UAAtB,EAAkC;IAChCC,eAAe,GAAGD,OAAlB;IACAA,OAAO,GAAGE,SAAV;EACD;;EACDF,OAAO,GAAGA,OAAO,IAAI,EAArB;EAEAF,QAAQ,CAACK,IAAT,CAAc,IAAd;EACA,KAAKC,IAAL,GAAY,SAAZ;EACA,KAAKC,IAAL,GAAYL,OAAO,CAACM,GAAR,IAAe,UAA3B;EACA,KAAKC,gBAAL,GAAwBN,eAAxB;AACD;AAED;AACA;AACA;;;AACAJ,IAAI,CAACW,QAAL,CAAcT,eAAd,EAA+BD,QAA/B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAC,eAAe,CAACU,SAAhB,CAA0BC,YAA1B,GAAyC,UAASC,GAAT,EAAcX,OAAd,EAAuB;EAC9D,IAAI,CAACW,GAAG,CAACC,OAAT,EAAkB;IAAE,OAAO,KAAKC,KAAL,CAAW,IAAIC,KAAJ,CAAU,6FAAV,CAAX,CAAP;EAA8H;;EAClJd,OAAO,GAAGA,OAAO,IAAI,EAArB;EAEA,IAAIe,IAAI,GAAG,IAAX;EAAA,IACIC,EADJ;;EAEA,IAAIL,GAAG,CAACC,OAAJ,CAAY,KAAKP,IAAjB,CAAJ,EAA4B;IAC1BW,EAAE,GAAGL,GAAG,CAACC,OAAJ,CAAY,KAAKP,IAAjB,EAAuBY,IAA5B;EACD;;EAED,IAAID,EAAE,IAAIA,EAAE,KAAK,CAAjB,EAAoB;IAClB;IACA;IACA;IAEA,IAAIE,MAAM,GAAGlB,OAAO,CAACmB,WAAR,GAAsBxB,KAAK,CAACgB,GAAD,CAA3B,GAAmC,IAAhD;;IACA,KAAKJ,gBAAL,CAAsBS,EAAtB,EAA0BL,GAA1B,EAA+B,UAASS,GAAT,EAAcH,IAAd,EAAoB;MACjD,IAAIG,GAAJ,EAAS;QAAE,OAAOL,IAAI,CAACF,KAAL,CAAWO,GAAX,CAAP;MAAyB;;MACpC,IAAI,CAACH,IAAL,EAAW;QACT,OAAON,GAAG,CAACC,OAAJ,CAAYG,IAAI,CAACV,IAAjB,EAAuBY,IAA9B;MACD,CAFD,MAEO;QACL,IAAII,QAAQ,GAAGV,GAAG,CAACW,aAAJ,IAAqB,MAApC;QACAX,GAAG,CAACU,QAAD,CAAH,GAAgBJ,IAAhB;MACD;;MACDF,IAAI,CAACQ,IAAL;;MACA,IAAIL,MAAJ,EAAY;QACVA,MAAM,CAACM,MAAP;MACD;IACF,CAZD;EAaD,CAnBD,MAmBO;IACLT,IAAI,CAACQ,IAAL;EACD;AACF,CAhCD;AAmCA;AACA;AACA;;;AACAE,MAAM,CAACC,OAAP,GAAiB3B,eAAjB"},"metadata":{},"sourceType":"script"}